---
title: "Distribución Uniforme Discreta"
lang: es
---

```{=html}
<style>
main.content {
text-align: justify}
</style>
```

```{r}
#| label: setup
#| include: false
library(tidyverse)
library(kableExtra)
library(gridExtra)
```

<br>

La **distribución uniforme discreta** es una de las distribuciones de probabilidad más elementales. Se caracteriza porque todos los valores posibles de la variable aleatoria tienen la misma probabilidad de ocurrir.

::: {#def-vaunif}
Una variable aleatoria discreta $X$ sigue una distribución uniforme discreta en el conjunto de $n$ números $\{x_1, x_2, \ldots, x_n\}$ si:

\begin{equation}
f(x) =  \begin{cases} 
\frac{1}{n} & \text{si } x \in \{x_1, x_2, \ldots, x_n\} \\
0 & \text{en otro caso}
\end{cases}
\end{equation}

Para denotar que una variable aleatoria $X$ tiene distribución uniforme escribimos:

\begin{equation}
X \sim \text{unif} \{x_1, x_2, \ldots, x_n\}
\end{equation}
:::

## Características Principales

**Función de Probabilidad**

\begin{equation}
f(x) = P(X = x) = \begin{cases} 
\frac{1}{n} & \text{si } x \in \{x_1, x_2, \ldots, x_n\} \\
0 & \text{en otro caso}
\end{cases}
\end{equation}

**Función de Distribución (Probabilidad Acumulada)**

Suponiendo que los valores $x_1, x_2, \ldots, x_n$ son $n$ enteros consecutivos, tenemos:

\begin{equation}
F(x) = P(X \leq x) = \begin{cases}
0 & \text{si } x < x_1 \\
\frac{\lfloor x \rfloor - x_1 + 1}{x_n-x_1+1} & \text{si } x_1 \leq x \leq x_n \\
1 & \text{si } x > x_n
\end{cases}
\end{equation}

**Parámetros Estadísticos**

Esperanza (Media):

\begin{equation}
E(X) = \frac{1}{n}\sum_{i=1}^n x_i = \mu
\end{equation}

Varianza:

\begin{equation}
\text{Var}(X) = \frac{1}{n}\sum_{i=1}^n (x_i-\mu)^2
\end{equation}

## Ejemplos y Aplicaciones

::: {#exm-dado}
### Lanzamiento de un dado

Un dado justo representa una distribución $X\sim \text{unif} \{1, 2, 3, 4, 5, 6\}$.

```{r}
#| code-fold: true
#| label: dado-ejemplo

# Parámetros del dado
x_1 <- 1
x_6 <- 6
valores <- x_1:x_6
probabilidades <- rep(1/length(valores), length(valores))

# Crear data frame
dado_data <- data.frame(
  Valor = valores,
  Probabilidad = probabilidades
)

# Mostrar tabla
kable(dado_data, 
      caption = "Distribución de probabilidad de un dado",
      align = "cc") %>%
  kable_styling(bootstrap_options = "striped")
```

**Cálculo de parámetros:**

```{r}
#| code-fold: true
#| label: parametros-dado
# Media
media <- sum(dado_data$Valor)/length(dado_data$Valor)
cat("Media:", media, "\n")

# Varianza
varianza <- sum((dado_data$Valor- media)^2)/length(dado_data$Valor)
cat("Varianza:", varianza, "\n")

# Desviación estándar
desv_std <- sqrt(varianza)
cat("Desviación estándar:", round(desv_std, 4), "\n")
```

### Visualización

```{r}
#| code-fold: true
#| label: grafico-dado
#| fig-cap: "Función de probabilidad de un dado"

ggplot(dado_data, aes(x = Valor, y = Probabilidad)) +
  geom_col(fill = "steelblue", alpha = 0.7, width = 0.6) +
  geom_text(aes(label = round(Probabilidad, 3)), vjust = -0.5) +
  scale_x_continuous(breaks = valores) +
  scale_y_continuous(limits = c(0, 0.20)) +
  labs(title = "Distribución Uniforme Discreta - Dado",
       x = "Valor",
       y = "Probabilidad") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```
:::

::: {#exm-num_random}
### Selección aleatoria de números

Supongamos que seleccionamos aleatoriamente un número entero entre 10 y 20 (inclusive).

**Cálculo de parámetros:**

```{r}
#| code-fold: true
#| label: ejemplo-numeros

x2_1 <- 10
x2_n <- 20
valores2 <- x2_1:x2_n
probabilidades2 <- rep(1/(length(valores2)), length(valores2))

# Data_frame
data2 <- data.frame(
  Valor = valores2,
  Probabilidad = probabilidades2
)

# Parámetros estadísticos
media2 <- mean(data2$Valor)
varianza2 <- sum((data2$Valor - media2)^2)/length(data2$Valor)
desv_std2 <- sqrt(varianza2)

cat("Media:", media2, "\n")
cat("Varianza:", round(varianza2, 4), "\n")
cat("Desviación estándar:", round(desv_std2, 4), "\n")
```

**Visualización de la función de probabilidad:**

```{r}
#| label: grafico-numeros
#| fig-cap: "Distribución uniforme discreta entre 10 y 20"


ggplot(data2, aes(x = Valor, y = Probabilidad)) +
  geom_col(fill = "darkgreen", alpha = 0.7, width = 0.8) +
  geom_text(aes(label = round(Probabilidad, 3)), 
            vjust = -0.5, size = 3) +
  scale_x_continuous(breaks = seq(10, 20, 1)) +
  labs(title = "Distribución Uniforme Discreta",
       x = "Valor",
       y = "Probabilidad") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))
```
:::

::: {#exm-simulacion}
### Simulación en R

Generación de números aleatorios de una variable aleatoria $X\sim unif\{1, 2, 3, 4, 5, 6\}$ y comparación con las probabilidades teóricas.

```{r}
#| code-fold: true
#| label: simulacion

# Generar 1000 números aleatorios
set.seed(123)
n_sim <- 1000
muestra <- sample(1:6, n_sim, replace = TRUE)

# Frecuencias observadas
freq_obs <- table(muestra)
freq_rel <- prop.table(freq_obs)

# Comparar con probabilidades teóricas
comparacion <- data.frame(
  Valor = 1:6,
  Prob_Teorica = rep(1/6, 6),
  Freq_Observada = as.numeric(freq_rel)
)

kable(comparacion, 
      caption = "Comparación entre probabilidades teóricas y observadas",
      col.names = c("Valor", "Prob. Teórica", "Freq. Observada"),
      digits = 4) |> 
  kable_styling(bootstrap_options = "striped")
```

<br>

**Visualización de la simulación**

```{r}
#| code-fold: true
#| label: grafico-simulacion
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"
#| fig-cap: "Comparación entre distribución teórica y simulada"


# Preparar datos para el gráfico
comp_long <- comparacion |> 
  pivot_longer(cols = c(Prob_Teorica, Freq_Observada),
               names_to = "Tipo",
               values_to = "Probabilidad") |> 
  mutate(Tipo = case_when(
    Tipo == "Prob_Teorica" ~ "Teórica",
    Tipo == "Freq_Observada" ~ "Observada"
  ))

ggplot(comp_long, aes(x = Valor, y = Probabilidad, fill = Tipo)) +
  geom_col(position = "dodge", alpha = 0.7) +
  scale_x_continuous(breaks = 1:6) +
  scale_fill_manual(values = c("Teórica" = "blue", "Observada" = "red")) +
  labs(title = paste("Simulación con", n_sim, "observaciones"),
       x = "Valor",
       y = "Probabilidad",
       fill = "Distribución") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "bottom")
```
:::

## Aplicaciones Prácticas

La distribución uniforme discreta tiene múltiples aplicaciones:

1.  **Juegos de azar**: Dados, ruletas, sorteos
2.  **Muestreo**: Selección aleatoria de elementos
3.  **Simulación**: Generación de números aleatorios equiprobables
4.  **Investigación**: Asignación aleatoria de tratamientos

## Propiedades Importantes

### Relación con otras distribuciones

-   Caso especial de la distribución categórica con probabilidades iguales
-   Límite discreto de la distribución uniforme continua
-   Base para generar otras distribuciones discretas

### Teorema Central del Límite

Verifiquemos el Teorema Central del Límite mediante simulación para el caso de variables aleatorias con distribución uniforme discreta. 

Generaremos $k=1000$ muestras cada una de tamaño $n=30$ de una distribución uniforme discreta en el conjunto $\{1, 2, 3, 4, 5, 6\}$ y observaremos la distribución de sus medias muestrales. En el @exm-dado se obtuvo que para $X\sim \text{unif}\{1, 2, 3, 4, 5, 6\}$ tenemos $\mu=7/2$ y $\sigma^2= 35/12$, luego la media muestral:

$$\bar{X}_{30}=\frac{1}{30}\sum_{i=1}^{30} X_i$$
Tendrá aproximadamente la siguiente distribución:

$$\bar{X}_n \sim N\left(\mu, \frac{\sigma^2}{n} \right)$$

Es decir

$$\bar{X}_{30} \sim N\left(\frac{7}{2}, \frac{7}{72} \right)$$



```{r}
#| code-fold: true
#| label: limite-central
#| fig-width: 8
#| fig-height: 6
#| fig-align: "center"
#| fig-cap: "Verificación del Teorema del Límite Central"
# Simular medias muestrales
set.seed(456)
k_muestra <- 1000
n_muestra <- 30

medias_muestrales <- replicate(k_muestra, {
  muestra <- sample(1:6, n_muestra, replace = TRUE)
  mean(muestra)
})

# Crear histograma
hist_data <- data.frame(Medias = medias_muestrales)

ggplot(hist_data) +
  geom_histogram(aes(x=Medias, after_stat(density)), bins = 30, 
                 fill = "lightblue", alpha = 0.7, color = "black") +
  geom_density(aes(x = Medias), color = "red", linewidth = 1) +
  geom_vline(xintercept = mean(medias_muestrales), 
             color = "blue", linetype = "dashed", linewidth = 1) +
  labs(title = "Distribución de Medias Muestrales",
       subtitle = paste("n =", n_muestra, " de una v.a. uniforme(1,6)"),
       x = "Media Muestral",
       y = "Densidad") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5))

# Estadísticas
cat("Media teórica:", (1+6)/2, "\n")
cat("Media observada:", round(mean(medias_muestrales), 4), "\n")
cat("Varianza teórica de la media:", round(((6-1+1)^2-1)/12/n_muestra, 4), "\n")
cat("Varianza observada de la media:", round(var(medias_muestrales), 4), "\n")
```

## Ejercicios Propuestos

::: {#exr-muestras}
Una urna contiene 8 bolas numeradas del 1 al 8. Se extrae una bola al azar. Calcule la probabilidad de obtener un número par.
:::
```{r}
bola_min <- 1
bola_max <- 8
n_bolas <- bola_max - bola_min + 1
n_sim <- 10000  




valores <- bola_min:bola_max
probabilidades <- rep(1/n_bolas, n_bolas)


datos_urna <- data.frame(
    Bola = valores,
    Probabilidad = probabilidades
)

print("DISTRIBUCIÓN DE PROBABILIDAD:")
print(datos_urna)


numeros_pares <- valores[valores %% 2 == 0] 
prob_par_teorica <- length(numeros_pares) / n_bolas

print("")
print("a) PROBABILIDAD DE OBTENER UN NÚMERO PAR:")
print(paste("   Números pares en la urna:", paste(numeros_pares, collapse = ", ")))
print(paste("   Cantidad de números pares:", length(numeros_pares)))
print(paste("   Probabilidad teórica P(par) =", length(numeros_pares), "/", n_bolas, "=", round(prob_par_teorica, 4)))
print(paste("   Esto es:", round(prob_par_teorica * 100, 2), "%"))

extracciones <- sample(valores, n_sim, replace = TRUE)
prob_par_simulada <- mean(extracciones %% 2 == 0)

print(paste("   Simulación (", n_sim, "extracciones):", round(prob_par_simulada, 4)))
print(paste("   Diferencia:", round(abs(prob_par_teorica - prob_par_simulada), 6)))
print("")


numeros_mayor_5 <- valores[valores > 5]
prob_mayor_5_teorica <- length(numeros_mayor_5) / n_bolas

print("b) PROBABILIDAD DE OBTENER NÚMERO > 5:")
print(paste("   Números > 5:", paste(numeros_mayor_5, collapse = ", ")))
print(paste("   Probabilidad teórica P(>5) =", length(numeros_mayor_5), "/", n_bolas, "=", round(prob_mayor_5_teorica, 4)))
print(paste("   Esto es:", round(prob_mayor_5_teorica * 100, 2), "%"))

prob_mayor_5_simulada <- mean(extracciones > 5)
print(paste("   Simulación:", round(prob_mayor_5_simulada, 4)))
print("")


es_primo <- function(n) {
  if (n < 2) return(FALSE)
  if (n == 2) return(TRUE)
  if (n %% 2 == 0) return(FALSE)
  for (i in 3:sqrt(n)) {
    if (n %% i == 0) return(FALSE)
  }
  return(TRUE)
}

numeros_primos <- valores[sapply(valores, es_primo)]
prob_primo_teorica <- length(numeros_primos) / n_bolas

print("c) PROBABILIDAD DE OBTENER NÚMERO PRIMO:")
print(paste("   Números primos:", paste(numeros_primos, collapse = ", ")))
print(paste("   Probabilidad teórica P(primo) =", length(numeros_primos), "/", n_bolas, "=", round(prob_primo_teorica, 4)))
print(paste("   Esto es:", round(prob_primo_teorica * 100, 2), "%"))

prob_primo_simulada <- mean(sapply(extracciones, es_primo))
print(paste("   Simulación:", round(prob_primo_simulada, 4)))
print("")


media_teorica <- mean(valores)
varianza_teorica <- sum((valores - media_teorica)^2) / n_bolas
desv_std_teorica <- sqrt(varianza_teorica)

print("PARÁMETROS ESTADÍSTICOS TEÓRICOS:")
print(paste("Media: E[X] =", round(media_teorica, 4)))
print(paste("Varianza: Var[X] =", round(varianza_teorica, 4)))
print(paste("Desviación estándar: σ =", round(desv_std_teorica, 4)))
print("")


media_simulada <- mean(extracciones)
varianza_simulada <- var(extracciones)
desv_std_simulada <- sd(extracciones)

print("PARÁMETROS ESTADÍSTICOS SIMULADOS:")
print(paste("Media muestral:", round(media_simulada, 4)))
print(paste("Varianza muestral:", round(varianza_simulada, 4)))
print(paste("Desviación estándar muestral:", round(desv_std_simulada, 4)))
print("")

grafico_distribucion <- ggplot(datos_urna, aes(x = factor(Bola), y = Probabilidad)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.7, width = 0.6) +
  geom_text(aes(label = round(Probabilidad, 3)), vjust = -0.5, size = 3) +
  labs(title = "Distribución Uniforme Discreta - Urna con 8 bolas",
       subtitle = "Probabilidad de cada resultado",
       x = "Número de la bola",
       y = "Probabilidad") +
  theme_minimal() +
  ylim(0, max(probabilidades) * 1.1)


frecuencias_simuladas <- table(extracciones) / n_sim
df_simulacion <- data.frame(
  Bola = as.numeric(names(frecuencias_simuladas)),
  Frecuencia = as.numeric(frecuencias_simuladas)
)

grafico_simulacion <- ggplot(df_simulacion, aes(x = factor(Bola), y = Frecuencia)) +
  geom_bar(stat = "identity", fill = "darkorange", alpha = 0.7, width = 0.6) +
  geom_hline(yintercept = 1/n_bolas, linetype = "dashed", color = "red") +
  geom_text(aes(label = round(Frecuencia, 3)), vjust = -0.5, size = 3) +
  labs(title = "Frecuencias Relativas Simuladas",
       subtitle = paste(n_sim, "extracciones - Línea roja: probabilidad teórica"),
       x = "Número de la bola",
       y = "Frecuencia relativa") +
  theme_minimal() +
  ylim(0, max(df_simulacion$Frecuencia) * 1.1)


print(grafico_distribucion)
print(grafico_simulacion)


print("RESUMEN:")
print("========")
print("En una distribución uniforme discreta:")
print(paste("- Todos los resultados tienen igual probabilidad: 1/", n_bolas))
print("- La probabilidad de un evento es: (casos favorables) / (casos totales)")
print("- La simulación confirma los resultados teóricos")
print("")
print("PROBABILIDADES CALCULADAS:")
print(paste("• P(par) =", round(prob_par_teorica, 4)))
print(paste("• P(>5) =", round(prob_mayor_5_teorica, 4)))
print(paste("• P(primo) =", round(prob_primo_teorica, 4)))
```

::: {#exr-enteros}
En un juego, se selecciona aleatoriamente un número entero entre 5 y 15 (inclusive). Calcule la media y la varianza de esta distribución.
:::
```{r}
numero_min <- 5
numero_max <- 15
n_numeros <- numero_max - numero_min + 1
n_sim <- 10000  



valores <- numero_min:numero_max
probabilidades <- rep(1/n_numeros, n_numeros)


datos_numeros <- data.frame(
    Numero = valores,
    Probabilidad = probabilidades
)

print("DISTRIBUCIÓN DE PROBABILIDAD:")
print(datos_numeros)


print("")
print("CÁLCULO TEÓRICO DE PARÁMETROS:")
print("==============================")


media_teorica <- mean(valores)
print(paste("Media teórica: E[X] =", round(media_teorica, 4)))
print(paste("   Fórmula: (a + b) / 2 = (", numero_min, "+", numero_max, ") / 2 =", 
            numero_min + numero_max, "/ 2 =", media_teorica))


varianza_teorica <- sum((valores - media_teorica)^2) / n_numeros
print("")
print(paste("Varianza teórica: Var[X] =", round(varianza_teorica, 4)))


print("   Cálculo paso a paso:")
print(paste("   Media μ =", round(media_teorica, 4)))
diferencias_cuad <- (valores - media_teorica)^2
print(paste("   Diferencias al cuadrado:", paste(round(diferencias_cuad, 4), collapse = ", ")))
print(paste("   Suma de diferencias al cuadrado:", round(sum(diferencias_cuad), 4)))
print(paste("   Varianza =", round(sum(diferencias_cuad), 4), "/", n_numeros, "=", round(varianza_teorica, 4)))


varianza_formula_cerrada <- ((n_numeros)^2 - 1) / 12
print("")
print(paste("   Fórmula cerrada: (n² - 1) / 12 = (", n_numeros, "² - 1) / 12 =", 
            round(varianza_formula_cerrada, 4)))


desv_std_teorica <- sqrt(varianza_teorica)
print("")
print(paste("Desviación estándar teórica: σ =", round(desv_std_teorica, 4)))


print("")
print("VERIFICACIÓN POR SIMULACIÓN:")
print("============================")


muestras <- sample(valores, n_sim, replace = TRUE)


media_simulada <- mean(muestras)
varianza_simulada <- var(muestras)
desv_std_simulada <- sd(muestras)

print(paste("Media muestral (simulación):", round(media_simulada, 4)))
print(paste("Varianza muestral (simulación):", round(varianza_simulada, 4)))
print(paste("Desviación estándar muestral (simulación):", round(desv_std_simulada, 4)))
print("")


print("COMPARACIÓN TEÓRICO vs SIMULACIÓN:")
print("===================================")
error_media <- abs(media_teorica - media_simulada)
error_varianza <- abs(varianza_teorica - varianza_simulada)

print(paste("Error en media:", round(error_media, 6)))
print(paste("Error en varianza:", round(error_varianza, 6)))
print(paste("Porcentaje de error en media:", round((error_media/media_teorica)*100, 4), "%"))
print(paste("Porcentaje de error en varianza:", round((error_varianza/varianza_teorica)*100, 4), "%"))
print("")


print("ANÁLISIS DE LA DISTRIBUCIÓN:")
print("============================")


rango <- numero_max - numero_min
print(paste("Rango:", rango))
print(paste("Valor mínimo:", min(valores)))
print(paste("Valor máximo:", max(valores)))
print(paste("Mediana teórica:", median(valores)))


print("Moda: Todos los valores tienen igual probabilidad (distribución uniforme)")



grafico_teorico <- ggplot(datos_numeros, aes(x = factor(Numero), y = Probabilidad)) +
  geom_bar(stat = "identity", fill = "steelblue", alpha = 0.7, width = 0.6) +
  geom_text(aes(label = round(Probabilidad, 3)), vjust = -0.5, size = 3) +
  geom_vline(xintercept = which(valores == round(media_teorica)), 
             linetype = "dashed", color = "red", size = 1) +
  annotate("text", x = which(valores == round(media_teorica)), y = max(probabilidades)*0.8,
           label = paste("Media =", round(media_teorica, 2)), color = "red", size = 4) +
  labs(title = "Distribución Uniforme Discreta - Probabilidad Teórica",
       subtitle = paste("Números del", numero_min, "al", numero_max),
       x = "Número",
       y = "Probabilidad") +
  theme_minimal() +
  ylim(0, max(probabilidades) * 1.1)


frecuencias_simuladas <- table(muestras) / n_sim
df_simulacion <- data.frame(
  Numero = as.numeric(names(frecuencias_simuladas)),
  Frecuencia = as.numeric(frecuencias_simuladas)
)

grafico_simulacion <- ggplot(df_simulacion, aes(x = factor(Numero), y = Frecuencia)) +
  geom_bar(stat = "identity", fill = "darkorange", alpha = 0.7, width = 0.6) +
  geom_hline(yintercept = 1/n_numeros, linetype = "dashed", color = "red", size = 1) +
  geom_vline(xintercept = which(valores == round(media_simulada)), 
             linetype = "dashed", color = "blue", size = 1) +
  geom_text(aes(label = round(Frecuencia, 3)), vjust = -0.5, size = 3) +
  annotate("text", x = which(valores == round(media_simulada)), y = max(df_simulacion$Frecuencia)*0.7,
           label = paste("Media sim =", round(media_simulada, 2)), color = "blue", size = 4) +
  labs(title = "Distribución Empírica - Frecuencias Relativas",
       subtitle = paste(n_sim, "muestras - Línea roja: probabilidad teórica"),
       x = "Número",
       y = "Frecuencia relativa") +
  theme_minimal() +
  ylim(0, max(df_simulacion$Frecuencia) * 1.1)


print(grafico_teorico)
print(grafico_simulacion)


```

::: {#exr-simulacion_4}
Simule 500 observaciones de una distribución uniforme discreta en {0, 1, 2, 3, 4} y compare las frecuencias observadas con las teóricas.
:::
```{r}
valores <- 0:4
n_valores <- length(valores)
n_observaciones <- 500
prob_teorica <- 1/n_valores

print("EJERCICIO 3: SIMULACIÓN DE DISTRIBUCIÓN UNIFORME DISCRETA")
print("=========================================================")
print(paste("Conjunto de valores: {", paste(valores, collapse = ", "), "}"))
print(paste("Número de observaciones a simular:", n_observaciones))
print(paste("Probabilidad teórica para cada valor: 1/", n_valores, "=", round(prob_teorica, 4)))
print("")


observaciones <- sample(valores, n_observaciones, replace = TRUE)


frecuencias_obs <- table(observaciones)
frecuencias_rel_obs <- frecuencias_obs / n_observaciones


frecuencias_teo <- rep(n_observaciones * prob_teorica, n_valores)
frecuencias_rel_teo <- rep(prob_teorica, n_valores)


comparacion <- data.frame(
    Valor = valores,
    Frecuencia_Observada = as.numeric(frecuencias_obs),
    Frecuencia_Teorica = frecuencias_teo,
    Frec_Rel_Observada = round(as.numeric(frecuencias_rel_obs), 4),
    Frec_Rel_Teorica = round(frecuencias_rel_teo, 4),
    Diferencia = round(abs(as.numeric(frecuencias_rel_obs) - frecuencias_rel_teo), 4)
)




diferencia_promedio <- mean(comparacion$Diferencia)
diferencia_maxima <- max(comparacion$Diferencia)

print("ESTADÍSTICAS DE LA COMPARACIÓN:")
print(paste("Diferencia promedio:", round(diferencia_promedio, 4)))
print(paste("Diferencia máxima:", round(diferencia_maxima, 4)))
print(paste("Error relativo promedio:", round(diferencia_promedio/prob_teorica * 100, 2), "%"))
print("")


chi_test <- chisq.test(frecuencias_obs, p = rep(prob_teorica, n_valores))

print("PRUEBA DE BONDAD DE AJUSTE (Chi-cuadrado):")
print(paste("Estadístico chi-cuadrado:", round(chi_test$statistic, 4)))
print(paste("Valor p:", round(chi_test$p.value, 4)))

if(chi_test$p.value > 0.05) {
  print("CONCLUSIÓN: No se rechaza H0 - Las frecuencias observadas son consistentes con la distribución teórica ✓")
} else {
  print("CONCLUSIÓN: Se rechaza H0 - Las frecuencias observadas NO son consistentes con la distribución teórica")
}
print("")


print("PARÁMETROS ESTADÍSTICOS:")
print("========================")


media_teorica <- mean(valores)
varianza_teorica <- sum((valores - media_teorica)^2) / n_valores
desv_std_teorica <- sqrt(varianza_teorica)

print("TEÓRICOS:")
print(paste("Media: E[X] =", round(media_teorica, 4)))
print(paste("Varianza: Var[X] =", round(varianza_teorica, 4)))
print(paste("Desviación estándar: σ =", round(desv_std_teorica, 4)))
print("")


media_obs <- mean(observaciones)
varianza_obs <- var(observaciones)
desv_std_obs <- sd(observaciones)

print("OBSERVADOS (simulación):")
print(paste("Media muestral:", round(media_obs, 4)))
print(paste("Varianza muestral:", round(varianza_obs, 4)))
print(paste("Desviación estándar muestral:", round(desv_std_obs, 4)))
print("")


print("COMPARACIÓN DE PARÁMETROS:")
print(paste("Diferencia en media:", round(abs(media_teorica - media_obs), 6)))
print(paste("Diferencia en varianza:", round(abs(varianza_teorica - varianza_obs), 6)))
print("")



df_absolutas <- data.frame(
    Valor = rep(valores, 2),
    Frecuencia = c(comparacion$Frecuencia_Observada, comparacion$Frecuencia_Teorica),
    Tipo = rep(c("Observada", "Teórica"), each = n_valores)
)

grafico_absolutas <- ggplot(df_absolutas, aes(x = factor(Valor), y = Frecuencia, fill = Tipo)) +
    geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +
    scale_fill_manual(values = c("Observada" = "steelblue", "Teórica" = "darkorange")) +
    labs(title = "Comparación: Frecuencias Absolutas",
         subtitle = paste("Simulación de", n_observaciones, "observaciones"),
         x = "Valor",
         y = "Frecuencia") +
    theme_minimal() +
    theme(legend.position = "top")


df_relativas <- data.frame(
    Valor = rep(valores, 2),
    Probabilidad = c(comparacion$Frec_Rel_Observada, comparacion$Frec_Rel_Teorica),
    Tipo = rep(c("Observada", "Teórica"), each = n_valores)
)

grafico_relativas <- ggplot(df_relativas, aes(x = factor(Valor), y = Probabilidad, fill = Tipo)) +
    geom_bar(stat = "identity", position = "dodge", alpha = 0.7) +
    scale_fill_manual(values = c("Observada" = "steelblue", "Teórica" = "darkorange")) +
    labs(title = "Comparación: Frecuencias Relativas",
         subtitle = paste("Probabilidad teórica =", round(prob_teorica, 3)),
         x = "Valor",
         y = "Probabilidad/Frecuencia Relativa") +
    theme_minimal() +
    theme(legend.position = "top") +
    geom_hline(yintercept = prob_teorica, linetype = "dashed", color = "red", alpha = 0.5)


grafico_diferencias <- ggplot(comparacion, aes(x = factor(Valor), y = Diferencia)) +
    geom_bar(stat = "identity", fill = "purple", alpha = 0.7, width = 0.6) +
    geom_text(aes(label = round(Diferencia, 4)), vjust = -0.5, size = 3) +
    labs(title = "Diferencias entre Frecuencias Observadas y Teóricas",
         x = "Valor",
         y = "Diferencia absoluta") +
    theme_minimal() +
    ylim(0, max(comparacion$Diferencia) * 1.1)


grafico_histograma <- ggplot(data.frame(Observaciones = observaciones), aes(x = Observaciones)) +
    geom_histogram(binwidth = 1, fill = "lightgreen", color = "black", alpha = 0.7) +
    geom_hline(yintercept = n_observaciones * prob_teorica, 
               linetype = "dashed", color = "red", size = 1) +
    labs(title = "Distribución de las 500 Observaciones Simuladas",
         subtitle = "Línea roja: frecuencia teórica esperada",
         x = "Valor",
         y = "Frecuencia") +
    theme_minimal() +
    scale_x_continuous(breaks = valores)


print(grafico_absolutas)
print(grafico_relativas)
print(grafico_diferencias)
print(grafico_histograma)


print("ANÁLISIS DE CONVERGENCIA:")
print("=========================")


tamanos_muestra <- seq(50, n_observaciones, by = 50)
medias_convergencia <- sapply(tamanos_muestra, function(n) {
    mean(observaciones[1:n])
})

df_convergencia <- data.frame(
    Muestra = tamanos_muestra,
    Media = medias_convergencia
)

grafico_convergencia <- ggplot(df_convergencia, aes(x = Muestra, y = Media)) +
    geom_line(color = "blue", size = 1) +
    geom_hline(yintercept = media_teorica, linetype = "dashed", color = "red", size = 1) +
    labs(title = "Convergencia de la Media Muestral",
         subtitle = "Cómo se aproxima la media observada a la teórica",
         x = "Tamaño de la muestra",
         y = "Media muestral") +
    theme_minimal()

print(grafico_convergencia)
```

